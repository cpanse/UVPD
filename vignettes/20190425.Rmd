
---
title: "20190425"
author: "AB/CP"
output:
  html_document:
    toc_float: true
    toc: true
    number_sections: true
    theme: united
bibliography: uvpd.bib
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Load

```{r}
library(uvpd)
load(file.path(system.file(package = 'uvpd'), "/extdata/fragments.RData"))
# load("~/__checkouts/R/uvpd/inst/extdata/uvpd-Meuse.RData")
rawfiles <- scan(file.path(system.file(package = 'uvpd'),
                           "/extdata/rawfiles.txt"), what = character())
rawfiles <- rawfiles[grepl("Castell|KWR|DB", rawfiles)]

```


# Extract XICs

```{r message=TRUE}
.assignAPEX
```

```{r message=TRUE}
.assignMatchedFragmentIons
```


```{r message=TRUE}


X <- mclapply(rawfiles, funfun, mc.cores=24)
```

```{r extractXICs, eval=FALSE}
library(parallel)
X <- mclapply(rawfiles[24:34], FUN = .assignAPEX, fragments=fragments.treeDepth1, mZoffset=1.007, mc.cores = 4)
#XX <- mclapply(X, FUN=.assignMatchedFragmentIons)
```

 

## Read Input



```{r, eval=FALSE}

uvpd.summary <- function(object, ...){
    
   list(
        sum=aggregate(log(intensity, 10) ~  scanTypeFilter * SMILES0 * rawfile , data=object, FUN=sum),
    length=aggregate(log(intensity, 10) ~  scanTypeFilter * SMILES0 * rawfile , data=object, FUN=length),
     quantile=aggregate(log(intensity, 10) ~  scanTypeFilter * SMILES0 * rawfile , data=object, FUN=quantile)
    )
}
```


```{r fig.retina=3, fig.width=19, fig.height=12, eval=FALSE}
KWRpos <- lapply(rawfiles[grepl("KWR.+(HCD|UVPD)", rawfiles)], analyze, smiles=ThermoUVPD_feb2019$SMILES)
lapply(KWRpos, function(x){try(uvpd.summary(x))})
    
KWRneg <- lapply(rawfiles[grepl("KWR.+(HCD|UVPD)", rawfiles)], analyze, smiles=ThermoUVPD_feb2019$SMILES, mZoffset=-1.007)
```